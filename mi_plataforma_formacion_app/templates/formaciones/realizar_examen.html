{% extends "base.html" %}
{% block content %}
<div class="container-lg">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-7">
      <div class="card mt-5 shadow-lg border-0 animate__animated animate__fadeIn" style="border-radius:1rem;">
        <div class="card-header text-center pb-0" style="background: linear-gradient(90deg,#bfa76a 60%,#f4f5f7 100%); color: #22305a; border-top-left-radius: 1rem; border-top-right-radius: 1rem; border-bottom: none;">
          <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" style="max-height:54px; margin-bottom:8px; background:rgba(255,255,255,0.15); border-radius:10px; box-shadow:0 2px 8px #0001; padding:4px;">
          <h3 class="mb-0 fw-bold mt-2" style="color:#fff; text-shadow:0 2px 8px #2222,0 1px 0 #0004; letter-spacing:0.5px;">Examen - {{ formacion.tipo_curso.nombre }} ({{ formacion.empresa.nombre }})</h3>
        </div>
        <div class="card-body py-4" style="background:#fff; border-bottom-left-radius:1rem; border-bottom-right-radius:1rem;">
          <div class="mb-3">
            <strong>Alumno:</strong> {{ alumno_formacion.alumno.nombre }} (DNI: {{ alumno_formacion.alumno.dni }})
          </div>
          <form method="post">
            <ol class="ps-2">
              {% for pregunta in preguntas %}
                <li class="mb-4">
                  <div class="fw-bold mb-2" style="font-size:1.1rem;">{{ pregunta.pregunta }}</div>
                  <div>
                    {% for opcion in pregunta.opciones %}
                      <div class="form-check mb-1">
                        <input class="form-check-input"
                               type="radio"
                               name="pregunta_{{ pregunta.id }}"
                               id="pregunta_{{ pregunta.id }}_{{ loop.index }}"
                               value="{{ opcion }}"
                               {% if respuestas_previas[pregunta.id|string]==opcion %}checked{% endif %}>
                        <label class="form-check-label" for="pregunta_{{ pregunta.id }}_{{ loop.index }}">
                          {{ opcion }}
                        </label>
                      </div>
                    {% endfor %}
                  </div>
                </li>
              {% endfor %}
            </ol>
            <div class="d-grid gap-2 mt-4">
              <button type="submit" class="btn btn-lg rounded-pill shadow" style="background:var(--color-btn-gold); color:#22305a; font-weight:600;">
                <i class="bi bi-save"></i> Guardar Examen
              </button>
            </div>
          </form>
          {% if examen_alumno %}
            <div class="alert alert-info mt-4">
              Ya existe un examen guardado para este alumno. Puedes modificarlo y volver a guardar.
            </div>
          {% endif %}

          {% if nota_final is defined %}
            <div class="mt-4 text-center">
              <div class="alert alert-success mb-3" style="font-size:1.15em;">
                <strong>¡Examen finalizado!</strong><br>
                Tu nota: <span class="badge bg-primary" style="font-size:1.1em;">{{ nota_final }}</span>
              </div>
              <div class="row justify-content-center g-3">
                <div class="col-md-6">
                  <div class="card shadow-sm border-0" style="background:linear-gradient(90deg,#eaf7fa 70%,#fff 100%);">
                    <div class="card-body text-center py-3">
                      <div class="fw-semibold mb-2" style="font-size:1.08em;color:#1882f7;">¿Quieres seguir aprendiendo o necesitas material profesional?</div>
                      <a href="https://soluciones-sanitarias.es" target="_blank" class="btn btn-lg btn-primary rounded-pill px-4 mb-2" style="font-weight:600;box-shadow:0 2px 8px #1882f722;">
                        <i class="bi bi-globe2"></i> Visita soluciones-sanitarias.es
                      </a>
                      <br>
                      <a href="https://ytsmed.es" target="_blank" class="btn btn-lg btn-info rounded-pill px-4" style="font-weight:600;box-shadow:0 2px 8px #0dcaf022;">
                        <i class="bi bi-bag-check"></i> Tienda online ytsmed.es
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

        <style>
        /* Responsive tweaks for exam entry page */
        @media (max-width: 991.98px) {
          .col-md-8.col-lg-7 { max-width: 94% !important; flex: 0 0 94% !important; }
          .card { margin-top: 1rem !important; }
          .card-header { padding: .8rem 1rem !important; border-radius: .75rem !important; }
          .card-header img { max-height:44px !important; margin-bottom:6px !important; }
          .card-header h3 { font-size:1.05rem !important; }
          ol.ps-2 { padding-left: 1rem !important; }
          .list-group-item, li { padding: .7rem 0 !important; }
          .form-check-label { font-size: 0.98rem !important; }
        }
        @media (max-width: 575.98px) {
          .card { margin-top: .8rem !important; }
          .card-body { padding: .8rem !important; }
          .card-header img { max-height:40px !important; }
          button.btn-lg { width: 100% !important; }
        }
        </style>

        {% endblock %}

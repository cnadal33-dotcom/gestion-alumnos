{% extends "base.html" %}
{% block head %}
<style>
.card-resumen-formacion {
  max-width: 900px;
  margin: 0 auto 18px auto;
  border-left: 5px solid var(--color-sidebar-active);
  border-radius: 1.1em;
  box-shadow: 0 3px 18px #bfa76a22;
  background: #fff;
  padding: 24px 36px 16px 36px;
}
.datos-ficha-linea {
  margin-bottom: 1.1em;
}
.dato-label {
  font-weight: 600; color: var(--color-sidebar-title); min-width: 145px; display: inline-block;
}
.dato-valor {
  color: var(--color-btn-navy); font-weight: 700; font-size: 1.08em; display: inline-block;
}
.botonera-top {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 1.2em;
  justify-content: flex-end;
}
.btn-elegante {
  border-radius: 2em;
  font-weight: 600;
  font-size: 1em;
  padding: 7px 20px;
  margin-bottom: 0;
  display: inline-flex;
  align-items: center;
  gap: 7px;
  box-shadow: 0 1px 6px #bfa76a22;
}
.btn-elegante.btn-outline {
  background: #fff;
  border: 2px solid var(--color-btn-navy);
  color: var(--color-btn-navy);
}
.btn-elegante.btn-outline:hover {
  background: #1882f7;
  color: #fff;
}
.btn-elegante.btn-success {
  background: var(--color-btn-navy);
  color: #fff;
  border: none;
}
.btn-elegante.btn-outline-danger {
  background: #fff;
  border: 2px solid var(--color-accent-gold);
  color: var(--color-accent-gold);
}
.btn-elegante.btn-outline-danger:hover {
  background: var(--color-accent-gold);
  color: #fff;
}
.table-sm th, .table-sm td {
  padding-top: 0.37rem !important;
  padding-bottom: 0.37rem !important;
  vertical-align: middle;
}
</style>
{% endblock %}

{% block content %}
<h2 class="mb-3 mt-2">Ficha de la formación</h2>
<div class="card card-resumen-formacion mb-3">
  <div class="datos-ficha-linea"><span class="dato-label">Fecha y horario:</span>
    <div class="d-flex flex-wrap gap-2">
      <div class="p-2 rounded border" style="background:#f6f7ff;min-width:180px;">
        <span class="fw-semibold text-primary">1º día:</span> {{ formacion.fecha1.strftime('%d/%m/%Y') if formacion.fecha1 else '' }}<br>
        <span class="fw-normal">{{ formacion.hora_inicio1.strftime('%H:%M') if formacion.hora_inicio1 else '' }} - {{ formacion.hora_fin1.strftime('%H:%M') if formacion.hora_fin1 else '' }}</span>
      </div>
      {% if formacion.dos_ediciones and formacion.fecha2 %}
      <div class="p-2 rounded border" style="background:#eaf7fa;min-width:180px;">
        <span class="fw-semibold text-info">2º día:</span> {{ formacion.fecha2.strftime('%d/%m/%Y') }}<br>
        <span class="fw-normal">{{ formacion.hora_inicio2.strftime('%H:%M') if formacion.hora_inicio2 else '' }} - {{ formacion.hora_fin2.strftime('%H:%M') if formacion.hora_fin2 else '' }}</span>
      </div>
      {% endif %}
    </div>
  </div>
  <div class="datos-ficha-linea"><span class="dato-label">Empresa:</span>
    <span class="dato-valor">{{ formacion.empresa.nombre }}</span>
  </div>
  <div class="datos-ficha-linea"><span class="dato-label">Curso:</span>
    <span class="dato-valor">{{ formacion.tipo_curso.nombre }}</span>
  </div>
  <div class="datos-ficha-linea"><span class="dato-label">Dirección del aula:</span>
    <span class="dato-valor">{{ formacion.direccion_aula or '-' }}</span>
  </div>
  <div class="datos-ficha-linea"><span class="dato-label">Formador:</span>
    <span class="dato-valor">{{ formacion.formador.nombre if formacion.formador else '-' }}</span>
  </div>
  <div class="datos-ficha-linea"><span class="dato-label">FUNDAE:</span>
    <span class="dato-valor">
      {% if formacion.fundae %}
        <span class="badge rounded-pill" style="background:var(--color-btn-navy);color:#fff;font-weight:600;">Sí</span>
      {% else %}
        <span class="badge rounded-pill" style="background:var(--color-accent-gold);color:#fff;font-weight:600;">No</span>
      {% endif %}
    </span>
  </div>
  <div class="datos-ficha-linea"><span class="dato-label">Observaciones:</span>
    <span class="dato-valor">{{ formacion.observaciones or '-' }}</span>
  </div>
</span>
  <div class="d-flex justify-content-end mt-3 gap-2">
    <a href="{{ url_for('formaciones_bp.gestion_formaciones') }}" class="btn btn-elegante btn-outline px-3 py-1" style="font-size:0.98em;">
      <i class="bi bi-arrow-left-circle"></i> Volver a gestión de formaciones
    </a>
    <a href="{{ url_for('formaciones_bp.generar_acta', formacion_id=formacion.id, plantilla_id=formacion.tipo_curso.plantilla_acta.id) }}?pdf=1"
      class="btn btn-outline-warning rounded-pill px-3 py-1 fw-semibold" style="border-color:var(--color-accent-gold);color:var(--color-accent-gold);font-weight:600;">
      <i class="bi bi-file-earmark-pdf"></i> Acta PDF
    </a>
  </div>
</div>

<!-- Tabla de alumnos (solo info, sin acciones ni enlaces) -->
<div class="table-responsive">
<table class="table table-sm table-hover table-bordered align-middle mb-0">
  <thead class="table-light">
    <tr>
      <th>Nombre Alumno</th>
      <th>DNI</th>
      <th>Email</th>
      <th>Nota</th>
      <th>Aprobado</th>
    </tr>
  </thead>
<tbody>
  {% for rel in alumnos_rel %}
  <tr>
    <td>{{ rel.alumno.nombre }}</td>
    <td>{{ rel.alumno.dni }}</td>
    <td>{{ rel.alumno.email }}</td>
    <td>
      {% if rel.nota is not none %}
        <span class="badge rounded-pill" style="background:var(--color-btn-navy);color:#fff;font-weight:600;">{{ rel.nota }}</span>
      {% else %}
        <span class="text-muted">-</span>
      {% endif %}
    </td>
    <td>
      {% if formacion.tipo_curso and formacion.tipo_curso.examen_modelo %}
        {% if rel.aprobado %}
          <span class="badge rounded-pill" style="background:var(--color-btn-navy);color:#fff;font-weight:600;">Aprobado</span>
        {% else %}
          <span class="badge rounded-pill" style="background:var(--color-accent-gold);color:#fff;font-weight:600;">No aprobado</span>
        {% endif %}
      {% else %}
        <span class="badge rounded-pill" style="background:var(--color-btn-navy);color:#fff;font-weight:600;">Apto</span>
      {% endif %}
    </td>
  </tr>
  {% else %}
  <tr>
    <td colspan="5" class="text-center">No hay alumnos inscritos en esta formación.</td>
  </tr>
  {% endfor %}
</tbody>
</table>
</div>
{% endblock %}

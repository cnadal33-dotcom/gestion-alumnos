{% extends "base.html" %}

{% block title %}Calendario de Formaciones{% endblock %}

{% block head %}
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
  <style>
  /* CALENDARIO MODERNO */
  .fc {
    font-family: 'Inter', 'Segoe UI', Arial, sans-serif !important;
    font-size: 15px;
  }
  .fc-toolbar-title {
    font-weight: bold;
    letter-spacing: 1px;
    font-size: 1.35rem;
  }
  .fc .fc-daygrid-event, .fc .fc-timegrid-event {
    border-radius: 8px;
    box-shadow: 0 1px 6px 0 rgba(60,60,60,.07);
    padding: 2px 8px;
    font-size: 0.97rem;
    color: #2a2a2a !important;
    font-weight: 500;
  }
  .fc .fc-daygrid-day.fc-day-today,
  .fc .fc-timegrid-col.fc-day-today {
    background: #fff4e0 !important;
  }
  .fc .fc-button-primary {
    background: #ff7700;
    border: none;
  }
  .fc .fc-button-primary:not(:disabled):hover {
    background: #e35d00;
  }
  .fc .fc-col-header-cell-cushion {
    font-size: 1rem;
    font-weight: 600;
  }
  .fc .fc-timegrid-slot-label {
    font-weight: 400;
    color: #555;
  }
  .fc .fc-daygrid-block-event .fc-event-title {
    white-space: normal !important;
  }
  .fc-theme-bootstrap5 .fc-scrollgrid {
    border-radius: 18px;
    border: none;
    box-shadow: 0 2px 10px 0 rgba(44,62,80,.10);
  }
  .fc .fc-event {
    transition: box-shadow 0.2s;
  }
  .fc .fc-event:hover {
    box-shadow: 0 4px 16px 0 rgba(44,62,80,0.20);
  }
  /* Tooltip elegante */
  .fc-tooltip-custom {
    position: absolute;
    z-index: 9999;
    background: #fff9ed;
    color: #2a2a2a;
    border: 1px solid #ffb870;
    border-radius: 12px;
    box-shadow: 0 6px 30px rgba(255,119,0,.18);
    padding: 12px 16px;
    font-size: 1rem;
    pointer-events: none;
    max-width: 320px;
    display: none;
  }
  /* Columna "Todo el día" más ancha */
  .fc-timegrid-axis-frame {
    min-width: 80px !important;
  }
  .fc-timegrid-all-day-cushion {
    font-size: 1rem;
    font-weight: 500;
    color: #ff7700 !important;
    letter-spacing: 0.5px;
  }
  /* Evento cerrado: opaco */
  .fc-event.cerrado {
    opacity: 0.60;
    filter: grayscale(0.4);
    font-style: italic;
  }
  </style>
{% endblock %}

{% block content %}
  <div class="container-lg py-4">
    <div class="card shadow-lg border-0 mx-auto" style="border-radius:1rem; max-width:1200px;">
      <div class="card-header d-flex align-items-center gap-3" style="background: var(--color-sidebar-active); color: var(--color-sidebar-title); border-top-left-radius: 1rem; border-top-right-radius: 1rem; border-bottom: none; min-height:60px;">
        <i class="bi bi-calendar-event" style="font-size:2rem; margin-right:10px; color:var(--color-sidebar-title);"></i>
        <h2 class="mb-0 fw-bold fs-4" style="color:var(--color-sidebar-title); text-shadow:0 2px 8px #bfa76a22,0 1px 0 #bfa76a22;">Calendario de Formaciones</h2>
      </div>
      <div class="card-body" style="background:#fff; border-bottom-left-radius:1rem; border-bottom-right-radius:1rem;">
        <div id="calendar" style="background: #fff; border-radius: 20px; box-shadow: 0 4px 40px #ffd7a9a0; padding: 18px 10px 10px 10px;"></div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/locales/es.global.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var calendarEl = document.getElementById('calendar');
      if (calendarEl) {
        var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth',
          locale: 'es',
          allDayText: 'Todo el día',
          firstDay: 1,
          themeSystem: 'bootstrap5',
          headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,listMonth'
          },
          buttonText: {
            today:    'Hoy',
            month:    'Mes',
            week:     'Semana',
            day:      'Día',
            list:     'Agenda'
          },
          views: {
            dayGridMonth: { buttonText: 'Mes' },
            timeGridWeek: { buttonText: 'Semana' },
            listMonth:    { buttonText: 'Agenda' }
          },
          events: "{{ url_for('formaciones_bp.api_formaciones_calendario') }}",
          eventClick: function(info) {
            if(info.event.url) {
              window.open(info.event.url, "_blank");
              info.jsEvent.preventDefault();
            }
          },
          height: "auto",
          nowIndicator: true,
          navLinks: true,
          eventTimeFormat: { hour: '2-digit', minute: '2-digit', hour12: false },
          eventDidMount: function(info) {
            // Tooltip elegante
            if (info.event.extendedProps.description) {
              let tooltip = document.createElement('div');
              tooltip.className = 'fc-tooltip-custom';
              tooltip.innerHTML = info.event.extendedProps.description;
              document.body.appendChild(tooltip);

              info.el.addEventListener('mouseenter', function(e) {
                tooltip.style.display = 'block';
                tooltip.style.left = (e.pageX + 12) + 'px';
                tooltip.style.top = (e.pageY + 12) + 'px';
              });
              info.el.addEventListener('mousemove', function(e) {
                tooltip.style.left = (e.pageX + 12) + 'px';
                tooltip.style.top = (e.pageY + 12) + 'px';
              });
              info.el.addEventListener('mouseleave', function() {
                tooltip.style.display = 'none';
              });
            }
            // Si la formación está cerrada, ponle la clase para opacar
            if (info.event.extendedProps.cerrada) {
              info.el.classList.add('cerrado');
            }
          }
        });
        calendar.render();
      }
    });
  </script>
{% endblock %}
